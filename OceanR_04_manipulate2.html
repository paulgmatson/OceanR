<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Manipulating Data Part 2</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 45px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 50px;
  margin-top: -50px;
}

.section h2 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h3 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h4 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h5 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h6 {
  padding-top: 50px;
  margin-top: -50px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">HOME</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="OceanR_01_intro.html">Intro to R</a>
</li>
<li>
  <a href="OceanR_02_realdata.html">Working with real data</a>
</li>
<li>
  <a href="OceanR_03_manipulate1.html">Manipulating Data: Part 1</a>
</li>
<li>
  <a href="OceanR_04_manipulate2.html">Manipulating Data: Part 2</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Manipulating Data Part 2</h1>

</div>


<div id="load-your-rda-file" class="section level2">
<h2>Load your Rda file</h2>
<p>Use the function <strong><em>load()</em></strong> to bring your dataframe into the R environment.</p>
<pre class="r"><code>load(&quot;BATSdata.Rda&quot;)</code></pre>
</div>
<div id="for-loops" class="section level2">
<h2>For Loops</h2>
<p>For loops are a fun alternative to lists for passing separate chunks of data through a function. For loops are used to iterate over a vector (run the same thing multiple times)</p>
<pre class="r"><code>for (val in sequence)
{
    statement
}</code></pre>
<p>The ‘val’ represents a value within the vector ‘sequence’. Each ‘val’ gets passed through the ‘statement’, which is what we want R to do for us.</p>
<p>Now let’s use a For loop to calculate the maximum temp for each cruise. We need to do a couple things before we let R calculate the max temps. First, we need to specify what our vector, which will be cruise number. Second, we need to create a place for the For loop to put our resulting data. If we don’t do that, if will just show the last value that it calculated.</p>
<pre class="r"><code># create vector of cruise numbers that we want to look at
cruises &lt;- c(seq(1:max(data$cruise)))
# create vector to put the resulting data
result &lt;- rep(NA,length(cruises))

for(i in cruises){
  result[i] &lt;- max(data[data$cruise==i,&quot;Temp&quot;], na.rm=T)
}
head(result)</code></pre>
<pre><code>## [1]  3.817 24.111 21.805 20.892 20.007 21.035</code></pre>
<pre class="r"><code>result[300]</code></pre>
<pre><code>## [1] 22.871</code></pre>
<p>Different goals may call for different approaches in terms of using an lapply function with lists or passing data through For loops.</p>
<p><strong><em>Note</em></strong>: If you pass a list through a function and get an error, nothing will be returned. However, if you get an error while using a For loop, the loop will stop at the place where the error occurred. This can be very helpful when you are debugging your code.</p>
</div>
<div id="writing-your-own-function" class="section level2">
<h2>Writing your own function</h2>
<p>The are many functions already available for you in R, but sometimes you need to be able to write your own. To do this, we use <strong>function()</strong>.</p>
<pre class="r"><code>function(x){
  statements
  return(something)
}</code></pre>
<p>For example, let’s make a function that converts celsius into farhenheit. After you run the lines containing the function, it will show up in your Environment window under “Functions”.</p>
<pre class="r"><code>c2f &lt;- function(x){
  degF &lt;- (x * (9/5)) +32
  result &lt;- paste(x,&quot; degrees C is equal to &quot;,degF,&quot; degrees F&quot;, sep=&quot;&quot;)
  return(result)
}

# now use the function to check temp of 12C
c2f(12)</code></pre>
<pre><code>## [1] &quot;12 degrees C is equal to 53.6 degrees F&quot;</code></pre>
<p>Notice that ‘degF’ is not shown in your Environment window. This is because things that happen in functions stay in functions, unless you tell it to return that value.</p>
<p><strong><em>Note</em></strong>: you can skip writing <strong>return()</strong> and just write the variable name if you want to save keystrokes.</p>
<p>Writing your own functions can even allow you to use R to go fishing!</p>
<pre class="r"><code># prompt &quot;Do you want to fish&quot;
fishing &lt;- function(){
  x &lt;- readline(&quot;Do you want to fish, y or n?&quot;)  
  out1 &lt;- sample(0:3,1)
  out2 &lt;- sample(0:3,1)
  out3 &lt;- ifelse(out1 == out2, &quot;You caught a fish!&quot;, &quot;No fish for you :-(&quot;)
  ifelse(x %in% c(&quot;y&quot;,&quot;Y&quot;), out3, &quot;Maybe next time&quot;)
}  

fishing()</code></pre>
<pre><code>## Do you want to fish, y or n?</code></pre>
<pre><code>## [1] &quot;Maybe next time&quot;</code></pre>
<p>Now let’s try something a little more complicated (and science-y). The BATS dataset is comprised of multiple casts that fire bottles at the same depths but may be used for different analyses. Let’s write a function that will index the dataframe and return observations (rows) that contain measurements of either TOC or TN. For simplicity, we will limit ourselves to working with a single cruise (250).</p>
<pre class="r"><code># subset dataframe to only look at cruise 250
cruise.250 &lt;- data[data$cruise==250,]</code></pre>
<p>First, we need to split up each cruise into separate casts.</p>
<pre class="r"><code># split df into separate casts
cast.list&lt;- split(cruise.250, cruise.250$cast)
# identify casts containing TOC or TN collected from the same bottle
findDOM.func &lt;- function(x){
    DOM &lt;- x[!(is.na(x$TOC) | is.na(x$TN)),]
    return(DOM)
}
# run the list through the function
DOM.list &lt;- lapply(cast.list, findDOM.func)

# alternatively, we can wirte the function within the lapply command
DOM.list2 &lt;- lapply(cast.list, function(x){
  DOM &lt;- x[!(is.na(x$TOC) | is.na(x$TN)),]
  return(DOM)
})</code></pre>
<p>Now, check the structure of DOM.list</p>
<pre class="r"><code>str(DOM.list)</code></pre>
<p>You see that while DOM.list still has eight elements (one for each cast), some of them are empty while others contain data. All of the elements containing data have values for either TOC or TN. As we showed in this example, functions can be use heirarchically, so that a function can use other functions within it.</p>
<div id="changing-a-list-to-a-dataframe" class="section level3">
<h3>Changing a list to a dataframe</h3>
<p>Sometimes we want to return a list back into a single dataframe. An easy way to do this is using the function <strong>rbindlist()</strong> which is in the ‘data.table’ package (you installed this earlier). sing <strong>rbindlist()</strong> alone creates an object that is both a data.table and a data.frame, which can confuse downstream processes). To solve this, we will also use the function <strong>data.frame()</strong>, which will force our new object to just be a data.frame.</p>
<pre class="r"><code>library(data.table) # makes the package available

#bind list elements into a dataframe called DOM.df
DOM.df &lt;- data.frame(rbindlist(DOM.list))
str(DOM.df) # check structure</code></pre>
<pre><code>## &#39;data.frame&#39;:    28 obs. of  39 variables:
##  $ Id         : num  1.03e+09 1.03e+09 1.03e+09 1.03e+09 1.03e+09 ...
##  $ yyyymmdd   : int  20090911 20090911 20090911 20090911 20090911 20090911 20090911 20090911 20090911 20090911 ...
##  $ decy       : num  2010 2010 2010 2010 2010 ...
##  $ time       : int  1610 1610 1610 1610 1610 1610 1610 1610 1610 1610 ...
##  $ latN       : num  31.7 31.7 31.7 31.7 31.7 ...
##  $ lonW       : num  64.2 64.2 64.2 64.2 64.2 ...
##  $ Depth      : num  300 400 501 600 701 ...
##  $ Temp       : num  18 17.6 16.5 14.1 11.7 ...
##  $ CTD_S      : num  36.5 36.5 36.3 35.8 35.5 ...
##  $ Sal1       : num  36.5 36.5 36.3 35.8 35.5 ...
##  $ Sig_th     : num  26.5 26.5 26.6 26.8 27.1 ...
##  $ O2_1       : num  203 193 182 163 147 ...
##  $ OxFix      : num  19.4 18.5 17.9 16 14.9 12.9 10.8 10.4 9.6 8.9 ...
##  $ Anom1      : num  -27.7 -40.1 -56.7 -87.4 -116.8 ...
##  $ CO2        : num  2109 2119 2132 NA NA ...
##  $ Alk        : num  2387 2383 2369 NA NA ...
##  $ NO3        : num  4.09 5.09 8.84 11.83 18.52 ...
##  $ NO2        : num  0 0 0 NA NA NA NA NA NA NA ...
##  $ PO4        : num  0.15 0.21 0.73 NA NA NA NA NA NA NA ...
##  $ Si         : num  1.55 1.33 2.81 5.86 9.98 ...
##  $ POC        : num  20.3 NA NA NA 33.3 ...
##  $ PON        : num  4 NA NA NA 3.84 NA NA 4.06 NA NA ...
##  $ TOC        : num  51.3 48.8 48 46.6 45.1 44.2 43.6 43.8 43.4 43.4 ...
##  $ TN         : num  8 9.1 11.2 17.6 23.2 27 25.8 24.1 22.8 20.6 ...
##  $ Bac        : num  1.2 1.1 NA NA NA 0.7 NA NA NA NA ...
##  $ POP        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ TDP        : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ SRP        : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ BSi        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ LSi        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ Pro        : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ Syn        : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ Piceu      : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ Naneu      : int  1 NA 1 NA NA NA NA NA NA NA ...
##  $ cruise.type: int  1 1 1 1 1 1 1 1 1 1 ...
##  $ cruise     : int  250 250 250 250 250 250 250 250 250 250 ...
##  $ cast       : int  3 3 3 3 3 3 3 3 3 3 ...
##  $ bottle     : int  1 2 3 4 5 6 7 8 12 14 ...
##  $ lonE       : num  296 296 296 296 296 ...</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
