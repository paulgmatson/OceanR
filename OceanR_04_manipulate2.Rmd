---
title: "Manipulating Data Part 2"
output: 
  html_document:
    toc: true
    toc_float: true
---

## Load your Rda file
Use the function ***load()*** to bring your dataframe into the R environment. 
```{r}
load("BATSdata.Rda")
```

## Writing your own function
The are many functions already available for you in R, but sometimes you need to be able to write your own. To do this, we use **function()**.
```{r eval=F}
function(x){
  statements
  return(something)
}
```

For example, let's make a function that converts celsius into farhenheit.
```{r}
c2f <- function(x){
  degF <- (x * (9/5)) +32
  result <- paste(x," degrees C is equal to ",degF," degrees F", sep="")
  return(result)
}

# now use the function to check temp of 12C
c2f(12)
```
Notice that 'degF' is not shown in your Environment window. This is because things that happen in functions stay in functions, unless you tell it to return that value.     

***Note***: you can skip writing **return()** and just write the variable name if you want to save keystrokes.  
   
Now let's try something a little more complicated. The BATS dataset is comprised of multiple casts that fire bottles at the same depths but may be used for different analyses. Let's write a function that will index the dataframe and return observations (rows) that contain measurements of either TOC or TN. For simplicity, we will limit ourselves to working with a single cruise (250).
```{r}
# subset dataframe to only look at cruise 250
cruise.250 <- data[data$cruise==250,]
```

First, we need to split up each cruise into separate casts.
```{r}
# split df into separate casts
cast.list<- split(cruise.250, cruise.250$cast)
# identify casts containing TOC or TN collected from the same bottle
findDOM.func <- function(x){
    DOM <- x[!(is.na(x$TOC) | is.na(x$TN)),]
    return(DOM)
}
# run the list through the function
DOM.list <- lapply(cast.list, findDOM.func)

# alternatively, we can wirte the function within the lapply command
DOM.list2 <- lapply(cast.list, function(x){
  DOM <- x[!(is.na(x$TOC) | is.na(x$TN)),]
  return(DOM)
})
```

Now, check the structure of DOM.list
```{r eval=F}
str(DOM.list)
```

You see that while DOM.list still has eight elements (one for each cast), some of them are empty while others contain data. All of the elements containing data have values for either TOC or TN. As we showed in this example, functions can be use heirarchically, so that a function can use other functions within it. 
